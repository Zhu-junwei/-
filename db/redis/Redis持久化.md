# RDB

RDB全称Redis Database Backup file(Redis数据备份文件)，也被叫做Redis数据快照。简单来说就是把内存中的所有数据都记录到磁盘中。当Redis实例故障重启后，从磁盘读取快照文件，恢复数据。

![](https://img2024.cnblogs.com/blog/1745057/202403/1745057-20240310171504870-1098995089.png)

Redis内部由触发RDB的机制，可以在redis.conf文件中找到，格式如下

```
# 900秒内，如果至少由1个key被修改，则执行bgsave
save 900 1
save 300 10
save 60 10000
```

# AOF

AOF全称为Append Only File(追加文件)。Redis处理的每一个写命令都会记录在AOF文件，可以看做是命令日志文件。

![](https://img2024.cnblogs.com/blog/1745057/202403/1745057-20240310173257120-699473898.png)

AOF默认是关闭的，需要修改redis.conf配置文件来开启AOF:

```
#是否开启AOF功能，默认是no
appendonly yes
# AOF文件的名称
appendfilename "appendonly.aof'
```

AOF的命令记录的频率也可以通过redis.conf文件来配:

```
# 表示每执行一次写命令，立即记录到AOF文件
appendfsync always
#写命令执行完先放入AOF缓冲区，然后表示每隔1秒将缓冲区数据写到AOF文件，是默认方案
appendfsync everysec
#写命令执行完先放入AOF缓冲区，由操作系统决定何时将缓冲区内容写回磁盘
appendfsync no
```

| 配置项      | 刷盘时机   | 优点          | 缺点             |
|----------|--------|-------------|----------------|
| Always   | 同步刷盘   | 可靠性高，几乎不丢数据 | 性能影响大          |
| everysec | 每秒刷盘   | 性能适中        | 最多丢失1秒数据       |
| no       | 操作系统控制 | 性能最好        | 可靠性较差，可能丢失大量数据 |

# RDB和AOF的优缺点

| 特性	      | RDB	                    | AOF          |
|----------|-------------------------|--------------|
| 持久化方式	   | 定时对整个内存做快照	             | 记录每一次执行的命令   | 
| 数据完整性	   | 不完整,两次备份之间会丢失	          | 相对完整,取决于刷盘策略 | 
| 文件大小	    | 会有压缩,文件体积小	             | 记录命令,文件体积很大  | 
| 宕机恢复速度	  | 很快	                     | 慢            | 
| 数据恢复优先级	 | 低,因为数据完整性不如AOF	         | 高,因为数据完整性更高  | 
| 系统资源占用	  | 高,大量CPU和内存消耗	           | 低,主要是磁盘IO资源  | 
| 使用场景	    | 可以容忍数分钟的数据丢失,追求更快的启动速度	 | 对数据安全性要求较高常见 | 
















